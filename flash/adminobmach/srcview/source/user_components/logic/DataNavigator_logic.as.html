<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>DataNavigator_logic.as</title>
<link rel="stylesheet" type="text/css" href="../../../SourceStyles.css"/>
</head>

<body><pre><span class="asPackage">package</span> user_components.logic<span class="asBracket">{</span>
    <span class="asReserved">import</span> user_components.DataNavigator;
    <span class="asReserved">import</span> mx.collections.ArrayCollection;
    <span class="asReserved">import</span> logic.HessianDataSet;
    <span class="asReserved">import</span> mx.controls.DataGrid;
    <span class="asReserved">import</span> mx.controls.Alert;
    <span class="asReserved">import</span> flash.events.Event;
    <span class="asReserved">import</span> mx.events.CloseEvent;
    <span class="asReserved">import</span> logic.HessianDataSetEvent;
    <span class="asReserved">import</span> flash.utils.setTimeout;
        <span class="asReserved">public</span> <span class="asClass">class</span> DataNavigator_logic    <span class="asBracket">{</span>        <span class="asReserved">private</span> <span class="asVar">var</span> navi <span class="asOperator">:</span> DataNavigator;                <span class="asBracket">[</span><span class="asMetadata">Bindable</span><span class="asBracket">]</span>        <span class="asReserved">public</span> <span class="asVar">var</span> dataSource <span class="asOperator">:</span> HessianDataSet;        <span class="asBracket">[</span><span class="asMetadata">Bindable</span><span class="asBracket">]</span>        <span class="asReserved">public</span> <span class="asVar">var</span> grid <span class="asOperator">:</span> DataGrid;                <span class="asReserved">public</span> <span class="asFunction">function</span> DataNavigator_logic <span class="asBracket">(</span>navi <span class="asOperator">:</span> DataNavigator <span class="asBracket">){</span>            <span class="asReserved">this</span>.navi <span class="asOperator">=</span> navi;        <span class="asBracket">}</span>                        <span class="asReserved">public</span> <span class="asFunction">function</span> onDataSetReady<span class="asBracket">(</span>e<span class="asOperator">:</span> HessianDataSetEvent<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>            dataSource.logger.info<span class="asBracket">(</span><span class="asString">&quot;onDataSetReady (status=&quot;</span><span class="asOperator">+</span>e.status<span class="asOperator">+</span><span class="asString">&quot;, lastCallFunctionName=&quot;</span><span class="asOperator">+</span>e.lastCallFunctionName<span class="asOperator">+</span><span class="asString">&quot;) &quot;</span><span class="asBracket">)</span>;            <span class="asReserved">if</span> <span class="asBracket">(</span>e.status <span class="asOperator">==</span> HessianDataSetEvent.STATUS_STARTING<span class="asBracket">){</span>                <span class="asReserved">return</span>;            <span class="asBracket">}</span>            <span class="asReserved">if</span> <span class="asBracket">(</span>HessianDataSetEvent.STATUS_FAIL <span class="asOperator">==</span> e.status <span class="asOperator">||</span> HessianDataSetEvent.STATUS_OK <span class="asOperator">==</span> e.status<span class="asBracket">){</span>                updateButtonsState<span class="asBracket">()</span>;            <span class="asBracket">}</span>            <span class="asComment">/*            if (e.status == HessianDataSetEvent.STATUS_OK &amp;&amp; e.lastCallFunctionName == HessianDataSetEvent.CMD_LOADDATASET){                onGotoFirstHandler (null);                                updateButtonsState ();            }            if (e.status == HessianDataSetEvent.STATUS_OK &amp;&amp; e.lastCallFunctionName == HessianDataSetEvent.CMD_LOADRECORD){                updateButtonsState ();            }            if (e.status == HessianDataSetEvent.STATUS_OK &amp;&amp; e.lastCallFunctionName == HessianDataSetEvent.CMD_POSTRECORD){                updateButtonsState ();            }            if (e.status == HessianDataSetEvent.STATUS_OK &amp;&amp; e.lastCallFunctionName == HessianDataSetEvent.CMD_DELETERECORD){                onGotoFirstHandler (null);                                updateButtonsState ();            }            */</span>        <span class="asBracket">}</span><span class="asComment">//end of -- onDataSetReady --</span>                                <span class="asComment">/*            public function updateButtonsState ():void{            setTimeout(_updateButtonsState, 100);        }            */</span>                <span class="asReserved">public</span> <span class="asFunction">function</span> updateButtonsState <span class="asBracket">()</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>            <span class="asReserved">if</span> <span class="asBracket">(</span>dataSource <span class="asOperator">==</span> <span class="asReserved">null</span><span class="asBracket">)</span> <span class="asReserved">return</span>;            dataSource.logger.info<span class="asBracket">(</span><span class="asString">&quot;updateButtonsState (isInEditState = &quot;</span><span class="asOperator">+</span>dataSource.isInEditState<span class="asOperator">+</span><span class="asString">&quot;) &quot;</span><span class="asBracket">)</span>;            navi.nav_first.enabled <span class="asOperator">=</span> <span class="asBracket">(</span><span class="asOperator">!</span> dataSource.isInEditState<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span>dataSource.getRecordCount<span class="asBracket">()</span> <span class="asOperator">&gt;</span> 0<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span>dataSource.currentRowIdx <span class="asOperator">&gt;</span> 0<span class="asBracket">)</span>;            navi.nav_prev.enabled <span class="asOperator">=</span> <span class="asBracket">(</span><span class="asOperator">!</span> dataSource.isInEditState<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span>dataSource.getRecordCount<span class="asBracket">()</span> <span class="asOperator">&gt;</span> 0<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span>dataSource.currentRowIdx <span class="asOperator">&gt;</span> 0<span class="asBracket">)</span>;            navi.nav_next.enabled <span class="asOperator">=</span> <span class="asBracket">(</span><span class="asOperator">!</span> dataSource.isInEditState<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span>dataSource.getRecordCount<span class="asBracket">()</span> <span class="asOperator">&gt;</span> 0<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span>dataSource.currentRowIdx <span class="asOperator">&lt;</span> dataSource.getRecordCount<span class="asBracket">()</span> <span class="asOperator">-</span> 1<span class="asBracket">)</span>;            navi.nav_last.enabled <span class="asOperator">=</span> <span class="asBracket">(</span><span class="asOperator">!</span> dataSource.isInEditState<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span>dataSource.getRecordCount<span class="asBracket">()</span> <span class="asOperator">&gt;</span> 0<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span>dataSource.currentRowIdx <span class="asOperator">&lt;</span> dataSource.getRecordCount<span class="asBracket">()</span> <span class="asOperator">-</span> 1<span class="asBracket">)</span>;            navi.nav_append.enabled <span class="asOperator">=</span> <span class="asBracket">(</span><span class="asOperator">!</span> dataSource.isInEditState<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span><span class="asOperator">!</span> navi.disabledCommandAppend<span class="asBracket">)</span>;            navi.nav_delete.enabled <span class="asOperator">=</span> <span class="asBracket">(</span>dataSource.getRecordCount<span class="asBracket">()</span> <span class="asOperator">&gt;</span> 0<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span><span class="asOperator">!</span> dataSource.isInEditState<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span>dataSource.currentRowIdx <span class="asOperator">&gt;=</span> 0<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span><span class="asOperator">!</span> navi.disabledCommandDelete<span class="asBracket">)</span>;            navi.nav_edit.enabled <span class="asOperator">=</span> <span class="asBracket">(</span>dataSource.getRecordCount<span class="asBracket">()</span> <span class="asOperator">&gt;</span> 0<span class="asBracket">)</span>  <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span><span class="asOperator">!</span> dataSource.isInEditState<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span>dataSource.currentRowIdx <span class="asOperator">&gt;=</span> 0<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span><span class="asOperator">!</span> navi.disabledCommandEdit<span class="asBracket">)</span>;            navi.nav_post.enabled <span class="asOperator">=</span> <span class="asBracket">(</span>dataSource.getRecordCount<span class="asBracket">()</span> <span class="asOperator">&gt;</span> 0<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> dataSource.isInEditState <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span>dataSource.currentRowIdx <span class="asOperator">&gt;=</span> 0<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span><span class="asOperator">!</span> navi.disabledCommandPost<span class="asBracket">)</span>;            navi.nav_cancel.enabled <span class="asOperator">=</span> <span class="asBracket">(</span>dataSource.getRecordCount<span class="asBracket">()</span> <span class="asOperator">&gt;</span> 0<span class="asBracket">)</span> <span class="asOperator">&amp;&amp;</span> dataSource.isInEditState <span class="asOperator">&amp;&amp;</span> <span class="asBracket">(</span>dataSource.currentRowIdx <span class="asOperator">&gt;=</span> 0<span class="asBracket">)</span>;            navi.nav_reload.enabled <span class="asOperator">=</span> <span class="asOperator">!</span> dataSource.isInEditState;        <span class="asBracket">}</span>                    <span class="asReserved">public</span> <span class="asFunction">function</span> moveToRecordByNumber <span class="asBracket">(</span>num <span class="asOperator">:</span> int<span class="asBracket">)</span><span class="asOperator">:</span>Boolean<span class="asBracket">{</span>            <span class="asReserved">if</span> <span class="asBracket">(</span>num<span class="asOperator">&lt;</span>0 <span class="asOperator">||</span> num <span class="asOperator">&gt;=</span> dataSource.getRecordCount<span class="asBracket">())</span> <span class="asReserved">return</span> <span class="asReserved">false</span>;            dataSource.currentRowIdx <span class="asOperator">=</span> num;            updateButtonsState<span class="asBracket">()</span>;                        <span class="asReserved">return</span> <span class="asReserved">true</span>;        <span class="asBracket">}</span>                <span class="asReserved">public</span> <span class="asFunction">function</span> locate <span class="asBracket">(</span>fieldName <span class="asOperator">:</span> String, fieldValue <span class="asOperator">:</span> Object<span class="asBracket">)</span><span class="asOperator">:</span>Boolean<span class="asBracket">{</span>            <span class="asReserved">if</span> <span class="asBracket">(</span>dataSource.locate <span class="asBracket">(</span>fieldName , fieldValue<span class="asBracket">)){</span>                <span class="asComment">//grid.selectedIndex = dataSource.currentRowIdx;</span>                updateButtonsState<span class="asBracket">()</span>;                            <span class="asReserved">return</span> <span class="asReserved">true</span>;            <span class="asBracket">}</span>            <span class="asReserved">else</span>                <span class="asReserved">return</span> <span class="asReserved">false</span>;        <span class="asBracket">}</span>        <span class="asReserved">public</span> <span class="asFunction">function</span> onChangeCurrentRow <span class="asBracket">(</span>e<span class="asOperator">:</span>Event<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>            dataSource.dataBindingToUI<span class="asBracket">()</span>;                        updateButtonsState<span class="asBracket">()</span>;        <span class="asBracket">}</span>        <span class="asReserved">public</span> <span class="asFunction">function</span> onGotoFirstHandler<span class="asBracket">(</span>e<span class="asOperator">:</span> DataNavigator<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>            dataSource.currentRowIdx <span class="asOperator">=</span> 0;            updateButtonsState<span class="asBracket">()</span>;        <span class="asBracket">}</span>                <span class="asReserved">public</span> <span class="asFunction">function</span> onGotoPrevHandler<span class="asBracket">(</span>e<span class="asOperator">:</span> DataNavigator<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>            <span class="asReserved">if</span> <span class="asBracket">(</span>dataSource.currentRowIdx <span class="asOperator">&gt;=</span> 1<span class="asBracket">){</span>                dataSource.currentRowIdx <span class="asOperator">=</span> dataSource.currentRowIdx <span class="asOperator">-</span> 1;                updateButtonsState <span class="asBracket">()</span>;                                <span class="asBracket">}</span>        <span class="asBracket">}</span>                <span class="asReserved">public</span> <span class="asFunction">function</span> onGotoNextHandler<span class="asBracket">(</span>e<span class="asOperator">:</span> DataNavigator<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>            <span class="asReserved">if</span> <span class="asBracket">((</span>dataSource.currentRowIdx <span class="asOperator">-</span>1 <span class="asBracket">)</span>  <span class="asOperator">&lt;</span> <span class="asBracket">(</span>dataSource.getRecordCount<span class="asBracket">()</span> <span class="asOperator">-</span> 1<span class="asBracket">)){</span>                dataSource.currentRowIdx <span class="asOperator">=</span> dataSource.currentRowIdx <span class="asOperator">+</span> 1;                updateButtonsState <span class="asBracket">()</span>;            <span class="asBracket">}</span>        <span class="asBracket">}</span>                <span class="asReserved">public</span> <span class="asFunction">function</span> onGotoLastHandler<span class="asBracket">(</span>e<span class="asOperator">:</span> DataNavigator<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>            dataSource.currentRowIdx <span class="asOperator">=</span> dataSource.getRecordCount<span class="asBracket">()</span> <span class="asOperator">-</span> 1;                updateButtonsState <span class="asBracket">()</span>;        <span class="asBracket">}</span>                <span class="asReserved">public</span> <span class="asFunction">function</span> onAppendRecordHandler<span class="asBracket">(</span>e<span class="asOperator">:</span> DataNavigator<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>            dataSource.appendRecord <span class="asBracket">()</span>;            updateButtonsState <span class="asBracket">()</span>;        <span class="asBracket">}</span>                <span class="asReserved">public</span> <span class="asFunction">function</span> onDeleteRecordHandler<span class="asBracket">(</span>e<span class="asOperator">:</span> DataNavigator<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>            mx.controls.Alert.show<span class="asBracket">(</span>                <span class="asString">&quot;Уверены что хотите удалить запись?&quot;</span>, <span class="asString">&quot;Подтверждение&quot;</span>,                 Alert.NO <span class="asOperator">|</span> Alert.YES, <span class="asReserved">null</span>, <span class="asFunction">function</span> <span class="asBracket">(</span>event<span class="asOperator">:</span>CloseEvent<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>                    <span class="asReserved">if</span> <span class="asBracket">(</span>event.detail <span class="asOperator">!=</span> Alert.YES<span class="asBracket">)</span> <span class="asReserved">return</span>;                    dataSource.deleteRecord <span class="asBracket">()</span>;                <span class="asBracket">})</span>;        <span class="asBracket">}</span>                <span class="asReserved">public</span> <span class="asFunction">function</span> onEditRecordHandler<span class="asBracket">(</span>e<span class="asOperator">:</span> DataNavigator<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>            dataSource.logger.info<span class="asBracket">(</span><span class="asString">&quot;onEditRecordHandler&quot;</span><span class="asBracket">)</span>;            dataSource.editRecord <span class="asBracket">()</span>;            updateButtonsState<span class="asBracket">()</span>;        <span class="asBracket">}</span>                <span class="asReserved">public</span> <span class="asFunction">function</span> onPostRecordHandler<span class="asBracket">(</span>e<span class="asOperator">:</span> DataNavigator<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>            dataSource.postRecord <span class="asBracket">()</span>;        <span class="asBracket">}</span>                <span class="asReserved">public</span> <span class="asFunction">function</span> onCancelRecordHandler<span class="asBracket">(</span>e<span class="asOperator">:</span> DataNavigator<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>            dataSource.cancelRecord <span class="asBracket">()</span>;            updateButtonsState<span class="asBracket">()</span>;        <span class="asBracket">}</span>                <span class="asReserved">public</span> <span class="asFunction">function</span> onReloadRecordHandler<span class="asBracket">(</span>e<span class="asOperator">:</span> DataNavigator<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>            dataSource.reloadDataSet <span class="asBracket">()</span>;        <span class="asBracket">}</span>                            <span class="asBracket">}</span><span class="asComment">// end of CLASS</span><span class="asBracket">}</span><span class="asComment">// end of PACKAGE</span>
</pre></body>
</html>
